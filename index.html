<!DOCKTYPE html>
<html lang="pt-br">

<head>
    <meta charset="utf-8" />
    <title>PROJETO-SOLAR</title>
    <link rel="stylesheet" href="https://limadouglas.github.io/arduinosolar/css/style.css" />
    <!---->
</head>

<body>
    <h1 margin="50%">PROJETO SOLAR
        <h1/>
        <hr align="center" width="80%" size="1" color="black">
        <table id="tabela_log" align="center">
            <tbody>
                <tr>
                    <th>ID</th>
                    <th>Descrição</th>
                </tr>
            </tbody>
        </table>


        <input type="button" name="btn" value="Motor1" onclick="criarJson('Motor1');" />
        <input type="button" name="btn" value="Motor2" onclick="criarJson('Motor2');" />


        <!-- meu script com firebase -->

        <script src="https://www.gstatic.com/firebasejs/3.7.3/firebase.js"></script>
        <script type="text/javascript" src="https://limadouglas.github.io/arduinosolar/script/jquery-3.2.0.min.js"></script>
        <script>
            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyAk1_Id4Z7Z4-_gszdUW230qUtLzq8qcdQ",
                authDomain: "solar-d6274.firebaseapp.com",
                databaseURL: "https://solar-d6274.firebaseio.com",
                storageBucket: "solar-d6274.appspot.com",
                messagingSenderId: "966387592758"
            };

            firebase.initializeApp(config);

            var cont;
            var refRaiz = firebase.database().ref();

            function atualizarCont() {
                refRaiz.on('value', function(snapshot) {
                    if (snapshot.child("contador").val() == null) {
                        cont = 0;
                        firebase.database().ref().update({
                            'contador': [cont]
                        });
                    } else
                        cont = parseInt(snapshot.child("contador").val());
                });
            }

            var starCountRef;
            var tabela = $('#tabela_log');

            $(document).ready(function() {

                atualizarCont();

                starCountRef = firebase.database().ref("/log");
                starCountRef.once('value').then(function(snapshot) {
                    snapshot.forEach(function(data) {
                        addTabela(data.key, data.val());
                    });
                });

            });

            function addTabela(chave, valor) {
                var novaLinha = $("<tr>");
                var coluna = "";
                coluna += '<td>' + chave + '</td>';
                coluna += '<td>' + valor + '</td>';
                novaLinha.append(coluna);
                tabela.append(novaLinha);
            }

            function criarJson(msg) {
                atualizarCont();

                firebase.database().ref("log/").update({
                    [++cont]: msg
                });

                firebase.database().ref().update({
                    'contador': [++cont]
                });

                starCountRef = firebase.database().ref("/log");
                starCountRef.once('value').then(function(snapshot) {
                    snapshot.forEach(function(data) {
                        if (cont == data.key)
                            addTabela(data.key, data.val());
                    });
                });
            }


            function enviar() {
                window.document.write("</br>chamou a funcao</br>");
            }

            function printar(msg) {
                // Pega a string do conteúdo atual
                var $wrapper = document.querySelector('.wrapper'),
                    HTMLTemporario = $wrapper.innerHTML,
                    // Novo HTML que será inserido
                    HTMLNovo = '</br>' + msg + '</br>';

                // Concatena as strings colocando o novoHTML antes do HTMLTemporario
                HTMLTemporario = HTMLNovo + HTMLTemporario;

                // Coloca a nova string(que é o HTML) no DOM
                $wrapper.innerHTML = HTMLTemporario;
            }

        </script>
</body>

</html>
